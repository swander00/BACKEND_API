# ===========================================
# BRAMPTON REAL ESTATE API - ENVIRONMENT CONFIGURATION
# ===========================================

# ===========================================
# SERVER CONFIGURATION
# ===========================================
PORT=8080
NODE_ENV=development
TZ=America/Toronto

# ===========================================
# SUPABASE CONFIGURATION
# ===========================================
SUPABASE_URL=https://gyeviskmqtkskcoyyprp.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5ZXZpc2ttcXRrc2tjb3l5cHJwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODMyMzkzOCwiZXhwIjoyMDczODk5OTM4fQ.KryixRJ8n-wy1n_WySex5qkHVST_awSudkM53SaSDj0
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5ZXZpc2ttcXRrc2tjb3l5cHJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMjM5MzgsImV4cCI6MjA3Mzg5OTkzOH0.qDOpA1nSwWdnQhIJQiQx-rjgl800EjTU3M90iKQQDiI

# ===========================================
# AMPRE RESO WEB API TOKENS
# ===========================================
# IDX (Available listings)
IDX_TOKEN=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ2ZW5kb3IvdHJyZWIvNjI4OSIsImF1ZCI6IkFtcFVzZXJzUHJkIiwicm9sZXMiOlsiQW1wVmVuZG9yIl0sImlzcyI6InByb2QuYW1wcmUuY2EiLCJleHAiOjI1MzQwMjMwMDc5OSwiaWF0IjoxNzU4NzMzOTQ2LCJzdWJqZWN0VHlwZSI6InZlbmRvciIsInN1YmplY3RLZXkiOiI2Mjg5IiwianRpIjoiNGM0NmIyOTgxNjhhODQ5YiIsImN1c3RvbWVyTmFtZSI6InRycmViIn0.AXTWrd_GMd19uiisBbW8IoFxqKzcEZrTSErSnT0qzkY

# VOW (Unavailable/Sold listings)
VOW_TOKEN=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ2ZW5kb3IvdHJyZWIvNjI4OSIsImF1ZCI6IkFtcFVzZXJzUHJkIiwicm9sZXMiOlsiQW1wVmVuZG9yIl0sImlzcyI6InByb2QuYW1wcmUuY2EiLCJleHAiOjI1MzQwMjMwMDc5OSwiaWF0IjoxNzU4NzMzOTE3LCJzdWJqZWN0VHlwZSI6InZlbmRvciIsInN1YmplY3RLZXkiOiI2Mjg5IiwianRpIjoiNzA5NDdjMDlhZmJhM2VjMiIsImN1c3RvbWVyTmFtZSI6InRycmViIn0.xbZpVm251NtG1XyZSCswXGO4eN14oCo71Lg_iAakRsQ

# Default Access Token (switchable for pipeline)
DEFAULT_ACCESS_TOKEN=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ2ZW5kb3IvdHJyZWIvNjI4OSIsImF1ZCI6IkFtcFVzZXJzUHJkIiwicm9sZXMiOlsiQW1wVmVuZG9yIl0sImlzcyI6InByb2QuYW1wcmUuY2EiLCJleHAiOjI1MzQwMjMwMDc5OSwiaWF0IjoxNzU4NzMzOTQ2LCJzdWJqZWN0VHlwZSI6InZlbmRvciIsInN1YmplY3RLZXkiOiI2Mjg5IiwianRpIjoiNGM0NmIyOTgxNjhhODQ5YiIsImN1c3RvbWVyTmFtZSI6InRycmViIn0.AXTWrd_GMd19uiisBbW8IoFxqKzcEZrTSErSnT0qzkY

# ===========================================
# AMPRE API ENDPOINT URLs
# ===========================================
# Property feeds with cursor-based pagination for incremental sync
IDX_URL=https://query.ampre.ca/odata/Property?$filter=ContractStatus eq 'Available' and PropertyType ne 'Commercial' and (ModificationTimestamp gt @lastTimestamp or (ModificationTimestamp eq @lastTimestamp and ListingKey gt '@lastKey'))&$orderby=ModificationTimestamp,ListingKey
VOW_URL=https://query.ampre.ca/odata/Property?$filter=ContractStatus ne 'Available' and PropertyType ne 'Commercial' and (ModificationTimestamp gt @lastTimestamp or (ModificationTimestamp eq @lastTimestamp and ListingKey gt '@lastKey'))&$orderby=ModificationTimestamp,ListingKey

# Media feed - pre-filtered to largest images, excluding Commercial
MEDIA_URL=https://query.ampre.ca/odata/Media?$filter=ClassName ne 'Commercial' and ImageSizeDescription eq 'Largest'&$orderby=MediaModificationTimestamp desc

# Template for batched media fetch by property keys
MEDIA_BATCH_FILTER_TEMPLATE=$filter=ResourceRecordKey in ({keys}) and ImageSizeDescription eq 'Largest'&$orderby=MediaModificationTimestamp

# Child resources
ROOMS_URL=https://query.ampre.ca/odata/PropertyRooms?$filter=ListingKey eq '@propertyKey'&$orderby=RoomKey
OPEN_URL=https://query.ampre.ca/odata/OpenHouse?$filter=ListingKey eq '@propertyKey' and OpenHouseDate ge @today&$orderby=OpenHouseKey

# ===========================================
# SYNC CONFIGURATION
# ===========================================
BATCH_SIZE_PROPERTY=1000
BATCH_SIZE_CHILD=500
MEDIA_PROPERTY_BATCH_SIZE=500
MEDIA_PAGE_SIZE=500
MEDIA_ENFORCE_MATCHING_ONLY=true

# Optional start date for delta sync (useful for backfills)
SYNC_START_DATE=2024-01-01T00:00:00Z

# ===========================================
# RATE LIMITING
# ===========================================
AMPRE_RATE_LIMIT_PER_MINUTE=120
AMPRE_RATE_LIMIT_PER_HOUR=5000

# ===========================================
# LOGGING & DEBUGGING
# ===========================================
LOG_LEVEL=info
LOG_FILE=logs/app.log
DEBUG=true
VERBOSE_LOGGING=true

# ===========================================
# FRONTEND CONFIGURATION
# ===========================================
NEXT_PUBLIC_BACKEND_URL=http://localhost:8080

# ===========================================
# API CONFIGURATION
# ===========================================
# CORS: Allowed origins (comma-separated, no spaces)
# Note: CORS uses origin (protocol + host + port), not full paths
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:3002,http://localhost:3003,http://localhost:3004,http://localhost:3005,http://localhost:3006,http://localhost:3007,http://localhost:3008,http://localhost:3009,https://new-frontend-lac-alpha.vercel.app

# Admin token for cache-bust endpoint (POST /admin/cache-bust)
# Generate a strong random string - this protects your admin endpoints
ADMIN_TOKEN=638bddb9ab65e5831b0a4bf87a383b44f0e69fd28850d187977e034bc5f60982

# Base URL for this API (used by refresh script to call cache-bust)
API_BASE_URL=http://localhost:8080

# ===========================================
# DATABASE CONFIGURATION
# ===========================================
# PostgreSQL connection string for MV refresh script
# Get this from Supabase: Project Settings > Database > Connection string
# Format: postgres://postgres:$supp0rt4wrkstn@[HOST]:5432/postgres
DATABASE_URL=postgres://postgres:$supp0rt4wrkstn@db.gyeviskmqtkskcoyyprp.supabase.co:5432/postgres

# ===========================================
# MATERIALIZED VIEW REFRESH
# ===========================================
# Optional: Auto-refresh MVs every N milliseconds (leave empty to disable)
# Example: 300000 = every 5 minutes
REFRESH_MVS_INTERVAL_MS=

# ===========================================
# API RATE LIMITING
# ===========================================
# Per-IP rate limit (defaults: 120 requests per 60 seconds)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=120

# ===========================================
# AI SERVICES CONFIGURATION
# ===========================================
# OpenAI API Key for AI summary generation for property descriptions
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here

# ===========================================
# GOOGLE MAPS CONFIGURATION
# ===========================================
# Google Maps Geocoding API Key for geocoding property addresses
# Get your API key from: https://console.cloud.google.com/
# Enable "Geocoding API" in Google Cloud Console
# Free tier: 40,000 requests/month
# NOTE: You can use the same API key as NEXT_PUBLIC_GOOGLE_MAPS_API_KEY from frontend
GOOGLE_MAPS_API_KEY=AIzaSyDUnBRDyD7LCQiafGFxvDslBud7YCWY2Vk

# Auto-geocoding during sync (set to 'false' to disable)
# When enabled, new properties will be automatically geocoded during sync
# Geocoding runs asynchronously and won't slow down the sync process
# 
# RECOMMENDATION: Set to 'false' during initial backfills to avoid rate limiting
#                 Use the dedicated geocoding script (npm run geocode) for bulk operations
#                 Keep enabled for normal incremental syncs (stays within free tier)
ENABLE_AUTO_GEOCODING=true